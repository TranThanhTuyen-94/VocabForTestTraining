<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Test Training</title>
  <!-- üêæ App Icon -->
<link rel="icon" type="image/png" href="assets/wordie-icon.png">
<link rel="apple-touch-icon" href="assets/wordie-icon.png">
<link rel="manifest" href="manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Be Vietnam Pro', sans-serif;
      background: linear-gradient(135deg, #f7faff, #e9f3ff);
      background-size: cover;
      margin: 0;
      color: #333;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      padding: 0 20px;
      overflow: hidden;
    }

    /* üè† Home button */
    #homeBtn {
      position: fixed;
      top: 15px;
      left: 15px;
      font-size: 1.8em;
      background: none;
      border: none;
      cursor: pointer;
      color: #333;
      z-index: 1000;
      transition: transform 0.2s;
    }
    #homeBtn:hover { transform: scale(1.15); }

    #selectorScreen {
      width: 100%;
      max-width: 600px;
      margin: 80px auto 0;
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
      text-align: center;
    }

    #reviewTitle {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .buttonLine {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 300px;
    }

    .mainBtn {
      flex: 1;
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 1.05em;
      font-weight: 500;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: white;
      box-shadow: 0 3px 8px rgba(0,0,0,0.12);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .mainBtn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 12px rgba(0,0,0,0.15);
    }

    #wordListBtn {
      background: linear-gradient(135deg, #a7c7ff, #7baaf7);
    }
    #startBtn {
      background: linear-gradient(135deg, #b6e2a1, #82c784);
    }

    #sheetList {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }

    #dateContainer {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      width: 100%;
      max-width: 600px;
    }

    .dateColumn {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
    }

    .dateColumn label {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 10px;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px 12px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.95em;
    }

    .dateColumn label:hover {
      background: #e8f0ff;
      transform: translateY(-2px);
    }

    .dateColumn input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: #5a8dfd;
      cursor: pointer;
    }

    #reviewScreen, #wordListScreen {
      overflow-y: auto;
      display: none;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      text-align: center;
    }

    #wordDisplay {
      font-size: 6em;
      margin: 40px 0 20px;
      color: #2E7D32;
    }

    #hintDisplay {
      font-size: 1.5em;
      color: #1976D2;
      margin-bottom: 30px;
    }

    .buttonRow {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    button {
      font-size: 1.3em;
      padding: 12px 30px;
      cursor: pointer;
      border: none;
      border-radius: 40px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    #hintBtn {
      background: linear-gradient(135deg, #ffd580, #ffb74d);
      color: white;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    #nextBtn {
      background: linear-gradient(135deg, #90caf9, #42a5f5);
      color: white;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    #gameBtn {
      background: linear-gradient(135deg, #b388eb, #9c27b0);
      color: white;
      font-size: 1.3em;
      padding: 12px 30px;
      border-radius: 40px;
      text-decoration: none;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    #gameBtn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    #endList {
      margin-top: 30px;
      font-size: 1.2em;
      max-width: 600px;
      text-align: left;
    }

    #wordListContent {
      width: 100%;
      max-width: 700px;
      text-align: left;
      background: rgba(255, 255, 255, 0.7);
      padding: 20px;
      border-radius: 10px;
    }

    #wordListContent li { margin: 6px 0; }

    @media (max-width: 480px) {
      #wordDisplay { font-size: 3.5em; }
      #hintDisplay { font-size: 0.9em; }
      .mainBtn { font-size: 0.95em; padding: 10px 16px; }
    }
  </style>
</head>
<body>

  <button id="homeBtn" title="Trang ch·ªß" onclick="goHome()">üè†</button>

  <div id="selectorScreen">
    <h1 id="reviewTitle">Test Training</h1>
    <div class="buttonLine">
      <button id="wordListBtn" class="mainBtn" onclick="openWordList()">Word List</button>
      <button id="startBtn" class="mainBtn" onclick="startReview()">Start</button>
    </div>
    <div id="sheetList"></div>
  </div>

  <div id="reviewScreen">
    <h1>Test Training</h1>
    <div id="wordDisplay">...</div>
    <div id="hintDisplay"></div>
    <div class="buttonRow">
      <button id="hintBtn">üí° Hint</button>
      <button id="nextBtn">‚úÖ Next</button>
    </div>
    <div class="buttonRow" id="gameButtonRow" style="display: none;">
      <a href="https://tranthanhtuyen-94.github.io/GameforTestTraining/" id="gameBtn">üéÆ Game</a>
    </div>
    <div id="endList"></div>
  </div>

  <div id="wordListScreen">
    <h1>üìò Word List</h1>
    <ul id="wordListContent"></ul>
  </div>

  <script>
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    const sheetId = '1PGKAbRIC0fP7IFK1UWAmqgcGI6xFZ114OBJ2CSIiMHk';
    const apiKey = 'AIzaSyDTI3yXucHM8LHQeSXJYYJJYVzufW0R6ik';

    let selectedSheets = [], allWords = [], currentIndex = 0, hintedWords = [], hintShown = false;

    const selectorScreen = document.getElementById('selectorScreen');
    const reviewScreen = document.getElementById('reviewScreen');
    const wordListScreen = document.getElementById('wordListScreen');
    const wordDisplay = document.getElementById('wordDisplay');
    const hintDisplay = document.getElementById('hintDisplay');
    const wordListContent = document.getElementById('wordListContent');

    async function loadSheetNames() {
      try {
        const res = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}?key=${apiKey}`);
        const data = await res.json();

        const sheetList = document.getElementById('sheetList');
        const dateContainer = document.createElement('div');
        dateContainer.id = 'dateContainer';

        const leftColumn = document.createElement('div');
        const rightColumn = document.createElement('div');
        leftColumn.className = 'dateColumn';
        rightColumn.className = 'dateColumn';

        data.sheets.forEach((sheet, index) => {
          const name = sheet.properties.title;
          const label = document.createElement('label');
          label.innerHTML = `<input type="checkbox" value="${name}"/> ${name}`;
          if (index % 2 === 0) leftColumn.appendChild(label);
          else rightColumn.appendChild(label);
        });

        dateContainer.appendChild(leftColumn);
        dateContainer.appendChild(rightColumn);
        sheetList.appendChild(dateContainer);

      } catch (error) {
        console.error("Error loading sheet names:", error);
        alert("‚ö†Ô∏è Failed to load lesson list. Please check your API key or sheet access.");
      }
    }

    async function startReview() {
      const checkboxes = document.querySelectorAll('#sheetList input:checked');
      selectedSheets = Array.from(checkboxes).map(cb => cb.value);
      if (selectedSheets.length === 0) return alert("Please select at least one lesson.");

      allWords = [];
      for (const sheet of selectedSheets) {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheet}?key=${apiKey}`;
        try {
          const res = await fetch(url);
          const data = await res.json();

          const words = data.values
            .filter(row => row.length >= 3)
            .map(row => ({
              word: row[0],
              hint: row[1] || '‚Äî',
              meaning: row[2] || '‚Äî'
            }));

          allWords.push(...words);
        } catch (error) {
          console.error(`Error loading sheet "${sheet}":`, error);
          alert(`Failed to load data from sheet "${sheet}".`);
        }
      }

      shuffleArray(allWords);
      currentIndex = 0;
      hintedWords = [];
      selectorScreen.style.display = 'none';
      wordListScreen.style.display = 'none';
      reviewScreen.style.display = 'flex';
      showWord();
    }

    async function openWordList() {
      const checkboxes = document.querySelectorAll('#sheetList input:checked');
      selectedSheets = Array.from(checkboxes).map(cb => cb.value);
      if (selectedSheets.length === 0) return alert("Please select at least one lesson.");

      let wordListHTML = "";
      for (const sheet of selectedSheets) {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheet}?key=${apiKey}`;
        try {
          const res = await fetch(url);
          const data = await res.json();

          const words = data.values
            .filter(row => row.length >= 3)
            .map(row => ({ en: row[0], vn: row[2] }));

          wordListHTML += `<h3 style="margin-top:25px;margin-bottom:10px;color:#1e40af;background:rgba(240,247,255,0.9);padding:8px 12px;border-radius:6px;display:inline-block;">üìò ${sheet}</h3><ul>`;
          wordListHTML += words.map(w => `<li><strong>${w.en}</strong> ‚Äî ${w.vn}</li>`).join('');
          wordListHTML += "</ul>";

        } catch (err) {
          console.error(err);
        }
      }

      selectorScreen.style.display = 'none';
      reviewScreen.style.display = 'none';
      wordListScreen.style.display = 'flex';
      wordListContent.innerHTML = wordListHTML;
    }

    function showWord() {
      hintDisplay.textContent = '';
      hintShown = false;
      if (currentIndex < allWords.length) {
        wordDisplay.textContent = allWords[currentIndex].word;
        document.getElementById('hintBtn').style.display = 'inline-block';
        document.getElementById('nextBtn').style.display = 'inline-block';
        document.getElementById('gameButtonRow').style.display = 'none';
      } else {
        wordDisplay.textContent = 'üéâ Done!';
        const listHTML = hintedWords.map(item =>
          `<li><strong>${item.word}</strong><br><em>Hint:</em> ${item.hint}<br><em>Meaning:</em> ${item.meaning}</li>`
        ).join('');
        document.getElementById('endList').innerHTML = `<h2>üìö Forgotten Words</h2><ul>${listHTML || '<li>None!</li>'}</ul>`;
        document.getElementById('hintBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('gameButtonRow').style.display = 'flex';
      }
    }

    function showHint() {
      if (!allWords.length || currentIndex >= allWords.length) return;
      const currentItem = allWords[currentIndex];
      if (!hintShown) {
        hintDisplay.textContent = `Hint: ${currentItem.hint}`;
        hintShown = true;
      }
    }

    function nextWord() {
      if (hintShown && currentIndex < allWords.length) {
        hintedWords.push(allWords[currentIndex]);
      }
      currentIndex++;
      showWord();
    }

    function goHome() {
      reviewScreen.style.display = 'none';
      wordListScreen.style.display = 'none';
      selectorScreen.style.display = 'flex';
      document.getElementById('endList').innerHTML = '';
      hintDisplay.textContent = '';
    }

    document.getElementById('hintBtn').onclick = showHint;
    document.getElementById('nextBtn').onclick = nextWord;
    document.addEventListener('keydown', e => {
      if (reviewScreen.style.display === 'flex') {
        if (e.code === 'Space') showHint();
        if (e.code === 'ArrowRight') nextWord();
      }
    });

    window.onload = loadSheetNames;
  </script>
</body>
</html>


